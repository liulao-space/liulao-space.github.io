(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{277:function(t,s,n){t.exports=n.p+"assets/img/00.ad58afb2.png"},300:function(t,s,n){"use strict";n.r(s);var a=n(3),e=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"react-组件生命周期"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#react-组件生命周期"}},[t._v("#")]),t._v(" React 组件生命周期")]),t._v(" "),s("p",[s("strong",[t._v("React 组件生命周期")]),t._v(" "),s("a",{attrs:{href:"http://react.caibaojian.com.cn/docs/react-component.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://react.caibaojian.com.cn/docs/react-component.html"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("每个组件都有几个“生命周期方法”，可以重写这些方法，已在过程中的特定时间运行代码。组件的声明周期大概分为三个阶段：")]),t._v(" "),s("p",[s("strong",[s("a",{attrs:{href:""}},[t._v("1. Mounting(装载)")])]),s("br"),t._v(" "),s("strong",[s("a",{attrs:{href:""}},[t._v("2. Updating(更新)")])]),s("br"),t._v(" "),s("strong",[s("a",{attrs:{href:""}},[t._v("3. Unmounting(卸载)")])])]),t._v(" "),s("p",[s("img",{attrs:{src:n(277),alt:"React 组件生命周期图",title:"组件生命周期图"}})]),t._v(" "),s("h2",{attrs:{id:"阶段一、mounting-装载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#阶段一、mounting-装载"}},[t._v("#")]),t._v(" 阶段一、Mounting(装载)")]),t._v(" "),s("p",[t._v("当组件实例被创建并将其插入 DOM 时，将按以下顺序调用这些方法")]),t._v(" "),s("ul",[s("li",[s("h3",{attrs:{id:"constructor-构造函数-两个目的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#constructor-构造函数-两个目的"}},[t._v("#")]),t._v(" "),s("strong",[t._v("constructor()")]),t._v(" 构造函数，两个目的:")]),t._v(" "),s("ul",[s("li",[t._v("通过分配一个对象到 "),s("code",[t._v("this.state")]),t._v(" 来初始化本地state，如：this.state = { counter: 0 };")]),t._v(" "),s("li",[t._v("将事件处理程序方法绑定到实例，如：this.handleClick = this.handleClick.bind(this);")])])]),t._v(" "),s("li",[s("h3",{attrs:{id:"componentwillmount-unsafe"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#componentwillmount-unsafe"}},[t._v("#")]),t._v(" "),s("strong",[t._v("componentWillMount()")]),t._v(" UNSAFE_")]),t._v(" "),s("p",[t._v("在数据挂载之前立即执行")])]),t._v(" "),s("li",[s("h3",{attrs:{id:"render"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#render"}},[t._v("#")]),t._v(" "),s("strong",[t._v("render()")])]),t._v(" "),s("p",[t._v("render() 方法是类组件中唯一必须的方法；")])]),t._v(" "),s("li",[s("h3",{attrs:{id:"componentdidmount"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#componentdidmount"}},[t._v("#")]),t._v(" "),s("strong",[t._v("componentDidMount()")])]),t._v(" "),s("p",[t._v("在数据挂载后立即执行，初始化所需要的DOM节点、"),s("strong",[t._v("远程加载数据、网络请求")]),t._v("应该放这里。")]),t._v(" "),s("p",[t._v("可以在 componentDidMount() 中调用 "),s("code",[t._v("setState()")]),t._v(", 在浏览器更新屏幕之前，会触发额外的渲染，在这种情况下，即使 "),s("code",[t._v("render()")]),t._v("会被调用两次，也可以保证用户不会看到中间状态。"),s("strong",[t._v("谨慎使用，通常会导致性能问题")])])])]),t._v(" "),s("h2",{attrs:{id:"阶段二、updating-更新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#阶段二、updating-更新"}},[t._v("#")]),t._v(" 阶段二、Updating(更新)")]),t._v(" "),s("p",[t._v("当 "),s("code",[t._v("props")]),t._v(" 或 "),s("code",[t._v("state")]),t._v(" 发生变更时会引起组件重新渲染，按以下顺序调用这些方法")]),t._v(" "),s("ul",[s("li",[s("h3",{attrs:{id:"componentwillreceiveprops-nextprops"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#componentwillreceiveprops-nextprops"}},[t._v("#")]),t._v(" "),s("strong",[t._v("componentWillReceiveProps(nextProps)")])])])]),t._v(" "),s("p",[t._v("在以装载组件接收 "),s("strong",[t._v("新props")]),t._v(" 之前被调用。如果需要更新 "),s("code",[t._v("state")]),t._v(" 以响应 "),s("code",[t._v("props")]),t._v("的更改，可以在此方法中比较 "),s("code",[t._v("this.props")]),t._v(" 和 "),s("code",[t._v("nextProps")]),t._v("并使用"),s("code",[t._v("this.state")]),t._v("执行状态转换。")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("即使 "),s("code",[t._v("props")]),t._v(" 没有改变，React也可能调用这个方法，如果只想处理变化，确保比较当前值和下一个值。当父组件导致子组件重新渲染时，可能发生这种情况")])]),t._v(" "),s("ul",[s("li",[s("h3",{attrs:{id:"shouldcomponentupdate-nextprops-nextstate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#shouldcomponentupdate-nextprops-nextstate"}},[t._v("#")]),t._v(" "),s("strong",[t._v("shouldComponentUpdate(nextProps, nextState)")])])])]),t._v(" "),s("p",[t._v("当接收到新的"),s("strong",[t._v("属性(props)")]),t._v(" 或 "),s("strong",[t._v("状态(state)")]),t._v(" 时，shouldComponentUpdate()在渲染之前被调用。默认返回 "),s("code",[t._v("true")]),t._v("。")]),t._v(" "),s("p",[t._v("此方法仅作为 "),s("strong",[t._v("性能优化")]),t._v(" 存在，不要依靠它来防止渲染。可以使用内置的 "),s("strong",[t._v("PureComponent")]),t._v("，而不是手动编写此方法，"),s("code",[t._v("PureComponent")]),t._v(" 对props 和 state 进行浅层比较。")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("ul",[s("li",[t._v("如果 "),s("code",[t._v("shouldComponentupdate()")]),t._v("返回false,那么UNSAFE_componentWillUpdate()、render()、componentDidUpdate()不会被调用。")]),t._v(" "),s("li",[t._v("不推荐进行深度相等检查或者在 "),s("code",[t._v("shouldComponentUpdate()")]),t._v("中使用JSON.stringify(),非常低效，"),s("strong",[t._v("会降低性能")]),t._v("。")])])]),t._v(" "),s("ul",[s("li",[s("h3",{attrs:{id:"componentwillupdate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#componentwillupdate"}},[t._v("#")]),t._v(" "),s("strong",[t._v("componentWillUpdate()")])])])]),t._v(" "),s("p",[t._v("当接收到新的"),s("strong",[t._v("属性(props)")]),t._v(" 或 "),s("strong",[t._v("状态(state)")]),t._v(" componentWillUpdate()在渲染之前被调用。第一次渲染不会被调用。")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("这里不能调用 "),s("code",[t._v("this.setState()")]),t._v("，不应该做任何其他事。"),s("br"),t._v("\n通常使用 "),s("code",[t._v("componentDidUpdate()")]),t._v("代替。")])]),t._v(" "),s("ul",[s("li",[s("h3",{attrs:{id:"render-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#render-2"}},[t._v("#")]),t._v(" "),s("strong",[t._v("render()")])])]),t._v(" "),s("li",[s("h3",{attrs:{id:"componentdidupdate-prevprops-prevstate-snapshot"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#componentdidupdate-prevprops-prevstate-snapshot"}},[t._v("#")]),t._v(" "),s("strong",[t._v("componentDidUpdate(prevProps, prevState, snapshot)")])])])]),t._v(" "),s("p",[s("code",[t._v("componentDidUpdate()")]),t._v("在更新发生后立即被调用，"),s("strong",[t._v("第一次渲染时不会被调用")]),t._v("。")]),t._v(" "),s("p",[t._v("当组件已更新时，可以在此"),s("strong",[t._v("操作DOM")]),t._v("，也可以发起 "),s("strong",[t._v("网络请求")]),t._v("，只需你比较当前的 props 与 以前的 props。")]),t._v(" "),s("h2",{attrs:{id:"阶段三、unmounting-卸载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#阶段三、unmounting-卸载"}},[t._v("#")]),t._v(" 阶段三、Unmounting(卸载)")]),t._v(" "),s("p",[t._v("当一个组件从 DOM 中删除时，将调用此方法：")]),t._v(" "),s("ul",[s("li",[s("h3",{attrs:{id:"componentwillunmount"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#componentwillunmount"}},[t._v("#")]),t._v(" "),s("strong",[t._v("componentWillUnmount()")])])])]),t._v(" "),s("p",[t._v("在一个组件被 卸载(unmounted) 和 销毁(destroyed)之前立即被调用。在此方法中执行必要的清理，如：清除定时器，取消网络取消等等，")]),t._v(" "),s("p",[t._v("例子：在 "),s("code",[t._v("componentDidMount()")]),t._v(" 中添加一个全局点击事件：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventlistener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("closeMenu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("添加"),s("code",[t._v("closeMenu()")]),t._v(" 方法：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("closeMenu")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-------------- 点击 closeMenu方法'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("在 "),s("code",[t._v("componentDidUnmount()")]),t._v(" 方法中清除点击事件，如果不清除，组件卸载时点击事件依然存在")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("closeMenu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[s("strong",[t._v("不应该在 componentWillUnmount()中调用setState()")]),t._v(", 因为组件不会被重新渲染。")])]),t._v(" "),s("h2",{attrs:{id:"错误处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误处理"}},[t._v("#")]),t._v(" 错误处理")]),t._v(" "),s("p",[t._v("在生命周期方法中，或在任何子组件的构造函数中，渲染过程中出现错误时调用此方法。")]),t._v(" "),s("ul",[s("li",[s("h3",{attrs:{id:"componentdidcatch-error-info"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#componentdidcatch-error-info"}},[t._v("#")]),t._v(" "),s("strong",[t._v("componentDidCatch(error, info)")])])])]),t._v(" "),s("p",[t._v("可以在其子组件树中的任何位置捕获JavaScript 错误，记录这些错误，并显示备用 UI 而不是崩溃的组件树")])])}),[],!1,null,null,null);s.default=e.exports}}]);